{% load i18n %}

{% block content %}

<style>
    .flex-grow {
        flex: 1;
    }
</style>

<div class="container">
    <div class="row my-5 justify-content-center">
        {% if user_vehicles %}
        {% for vehicle in user_vehicles %}

        <div class="col-sm-4 mb-3">
            <div class="card d-flex flex-column h-100">
                <!-- Unsplash Image as Cover -->
                {# <img src="https://source.unsplash.com/random/250x150/?car" class="card-img-top" alt="Vehicle Image" style="object-fit: cover; width: 100%; height: 150px;"> #}

                {% for vehicle_image in vehicle_images %}
                {% if vehicle_image.vehicle == vehicle %}
                <img src="{{ vehicle_image.image.url }}" class="card-img-top" alt="Vehicle Image" style="object-fit: cover; width: 100%; height: 150px;">
                {% endif %}
                {% endfor %}

                <div class="card-body flex-grow">
                    <h5 class="card-title">{{ vehicle|default_if_none:"Name?" }}</h5>
                    <p class="card-text">{{ vehicle.make|default_if_none:"Make?" }}, {{ vehicle.model|default_if_none:"Model?" }}, {{ vehicle.year|default_if_none:"Year?" }}, {{ vehicle.fuel_type|default_if_none:"Fuel?" }}</p>
                </div>
                <div class="d-flex justify-content-around mt-auto p-3">
                    <!-- Stats Button -->


                    <a href="{% url 'refuel:vehicle_details' vehicle.id %}" class="btn btn-success">{%trans 'Details'%}</a>

                    <!-- Delete Button -->
                    <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal-{{ vehicle.id }}">
                        <i class="bi bi-trash-fill"></i>{%trans 'Delete'%}
                    </button>
                </div>
            </div>
        </div>

        {% endfor %}

        {% else %}

        <h2 class="text-center">{%trans 'No vehicles yet.'%}</h2>

        {% endif %}
    </div>
</div>






<!-- Bootstrap Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="deleteItem()">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
    function deleteItem() {
        // Add your delete logic here
        console.log('Item deleted'); // Example action
        // Close the modal after the action
        $('#deleteConfirmModal').modal('hide');
    }


    function deleteVehicle(vehicleId) {
        fetch('/api/delete_vehicle/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken // assuming you have the CSRF token available
            },
            body: JSON.stringify({ vehicle_id: vehicleId })
        })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
                // Optionally, redirect or update the UI upon successful deletion
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }


</script>

{% endblock %}